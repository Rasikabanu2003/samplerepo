using DemoApi.web.Controllers.model;
using Microsoft.EntityFrameworkCore;
using static DemoApi.web.Controllers.model.student;

public class ApplicationDbContext : DbContext
{
    public ApplicationDbContext(DbContextOptions<ApplicationDbContext> options)
        : base(options)
    {
    }

    public DbSet<Student> Students { get; set; }
    public DbSet<Country> Countries { get; set; }
    public DbSet<State> States { get; set; }
    public DbSet<District> Districts { get; set; }
    protected override void OnModelCreating(ModelBuilder modelBuilder)
    {
        // üåç Country - State Relationship
        modelBuilder.Entity<State>()
            .HasOne(s => s.Country)
            .WithMany(c => c.States)
            .HasForeignKey(s => s.CountryId)
            .OnDelete(DeleteBehavior.Restrict);

        // üèõ State - District Relationship
        modelBuilder.Entity<District>()
            .HasOne(d => d.State)
            .WithMany(s => s.Districts)
            .HasForeignKey(d => d.StateId)
            .OnDelete(DeleteBehavior.Restrict);

        // üéì Student - District Relationship (Only storing DistrictId)
        modelBuilder.Entity<Student>()
            .HasOne(s => s.District)
            .WithMany(d => d.Students)
            .HasForeignKey(s => s.DistrictId)
            .OnDelete(DeleteBehavior.Restrict);
    }


}
